<html>
<head>
	<title>homepage test</title>
	<link rel="stylesheet" href="stylesheets/cmd.css">
	<script language="JavaScript" type="text/javascript" src="termlib/termlib.js"></script>

<script type="text/javascript">
<!--

// *** request sample ***
// mass:werk, N.Landsteiner 2007

var term;

var help = [
	'%+r **** termlib socket sample **** %-r',
	' ',
	'* type "get" and a filename to send a http-request,',
	'  use option -e for a JSON-style eval',
	'* type "help" for this page',
	'* type "exit" to quit.',
	' ',
	'TESTS:',
	'  for a normal file request try:  get tests/test1.txt',
	'  for an evaled JSON request try: get -e tests/test2.txt',
	' '
];

function termOpen() {
	if ((!term) || (term.closed)) {
		term = new Terminal(
			{
				x: 0,
				y: 0,
				termDiv: 'termDiv',
				bgColor: '#111111',
				crsrBlinkMode: true,
				greeting: help.join('\n'),
				handler: termHandler,
				exitHandler: termExitHandler
			}
		);
		term.open();
		
		// dimm UI text
		var mainPane = (document.getElementById)?
			document.getElementById('mainPane') : document.all.mainPane;
		if (mainPane) mainPane.className = 'lh15 dimmed';
	}
}

function termExitHandler() {
	// reset the UI
	var mainPane = (document.getElementById)?
		document.getElementById('mainPane') : document.all.mainPane;
	if (mainPane) mainPane.className = 'lh15';
}

function pasteCommand(text) {
	// insert given text into the command line and execute
	var termRef = TermGlobals.activeTerm;
	if ((!termRef) || (termRef.closed)) {
		alert('Please open the terminal first.');
		return;
	}
	if ((TermGlobals.keylock) || (termRef.lock)) return;
	termRef.cursorOff();
	termRef._clearLine();
	for (var i=0; i<text.length; i++) {
		TermGlobals.keyHandler({which: text.charCodeAt(i), _remapped:true});
	}
	TermGlobals.keyHandler({which: termKey.CR, _remapped:true});
}

function termHandler() {
	this.newLine();
	
	this.lineBuffer = this.lineBuffer.replace(/^\s+/, '');
	var argv = this.lineBuffer.split(/\s+/);
	var cmd = argv[0];
	
	switch (cmd) {
		case 'get':
			if (argv[1] == '-e') {
				// option -e
				if (argv.length >= 3) {
					this.send(
						{
							url: argv[2],
							method: 'get',
							callback: myServerCallback,
							getHeaders: ['Content-Type', 'Content-Length']
						}
					);
					return;
				}
			}
			else if (argv.length >= 2) {
				// use default request-callback
				this.send(
					{
						url: argv[1],
						method: 'get'
					}
				);
				return;
			}
			this.write('Usage: send [-e] filename');
			break;

		case 'help':
			this.clear();
			this.write(help);
			break;

		case 'exit':
			this.close();
			return;

		default:
			if (this.lineBuffer != '') {
				this.type(this.lineBuffer + ': unknown command');
				this.newLine();
			}
	}
	this.prompt();
}

function myServerCallback() {
	var response=this.socket;
	if (response.success) {
		var func=null;
		try {
			func=eval(response.responseText);
		}
		catch (e) {
		}
		if (typeof func=='function') {
			try {
				func.apply(this);
			}
			catch(e) {
				this.write('An error occured within the imported function: '+e);
			}
		}
		else {
			this.write('Server Response:\n' + response.responseText);
		}
		this.newLine();
		this.write('Response Statistics:');
		this.newLine();
		this.write('  Content-Type: ' + response.headers.contentType);
		this.newLine();
		this.write('  Content-Length: ' + response.headers.contentLength);
	}
	else {
		var s='Request failed: ' + response.status + ' ' + response.statusText;
		if (response.errno) s +=  '\n' + response.errstring;
		this.write(s);
	}
	this.prompt();
}

//-->
</script>

</head>


<body bgcolor="#222222" link="#77dd11" text="#cccccc" alink="#eeeeee" vlink="#77dd11"
topmargin="0" bottommargin="0" leftmargin="0" rightmargin="0" marginheight="0" marginwidth="0">

<table border="0" cellspacing="20" cellpadding="0" align="center">
<tr>
	<td nowrap><a href="index.html">termlib.js home</a></td>
	<td>|</td>
	<td nowrap><a href="multiterm_test.html">multiple terminals</a></td>
	<td>|</td>
	<td nowrap><a href="parser_sample.html">parser</a></td>
	<td>|</td>
	<td nowrap><a href="faq.html">faq</a></td>
	<td>|</td>
	<td nowrap><a href="readme.txt" title="readme.txt (text/plain)">documentation</a></td>
	<td>|</td>
	<td nowrap><a href="samples.html" style="color: #cccccc;">samples</a></td>
</tr>
</table>

<table border="0" cellspacing="20" cellpadding="0">
	<tr valign="top">
	<td nowrap>
		<table border="0" cellspacing="0" cellpadding="0" width="190" class="inventory">
		<tr><td nowrap>
			Server Request Sample<br>&nbsp;
		</td></tr>
		<tr><td nowrap>
			<a href="javascript:termOpen()" onfocus="if(this.blur)this.blur();" onmouseover="window.status='open terminal'; return true" onmouseout="window.status=''; return true" class="termopen">&gt; open terminal&nbsp;</a>
		</td></tr>
		<tr><td nowrap>
			<p>Tests:</p>
			<p><a href="javascript:pasteCommand('get tests/test1.txt')" onfocus="if(this.blur)this.blur();" class="termopen">&gt; 1) a simple request&nbsp;</a></p>
			<p><a href="javascript:pasteCommand('get -e tests/test2.txt')" onfocus="if(this.blur)this.blur();" class="termopen">&gt; 2) a JSON request &nbsp;</a></p>
		</td></tr>
		<tr><td nowrap>
			&nbsp;
		</td></tr>
		<tr><td nowrap class="lh15">
			&nbsp;<br>
			(c) mass:werk,<br>N. Landsteiner 2005-2007<br>
			<a href="http://www.masswerk.at/" target="_blank">http://www.masswerk.at</a>
		</td></tr>
		</table>
	</td>
	<td class="lh15" width="560" id="mainPane">
		<p><b style="letter-spacing: 1px;">termlib-Socket Sample</b><br>&nbsp;</p>
		
		<p>This page demos the termlib.js socket extension for client-server communication via asynchronous XMLHttpRequests (commonly known as AJAX).</p>
		<p>The socket extension provides a tight integration for all XMLHttpRequest tasks that would commonly occur in a real world application.</p>
		<p>All you have to do, is call the <tt>send( &lt;options&gt; )</tt> method and return.<br>The request (might it succeed or fail) will come back to your callback-handler with your Terminal instance set as the <tt>this</tt> object.</p>
		
	</td>
	</tr>
</table>

<div id="termDiv" style="position: relative; z-index:1;"></div>

</body>
</html>                                                                     
